<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home - Spezz.Exchange</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Welcome to Spezz.Exchange</h1>
    <button id="logout">Logout</button>

    <!-- Approved Games Section -->
    <h2>Approved Games</h2>
    <div id="games-list"></div>

    <!-- Weekly Site Visits -->
    <h2>Weekly Site Visits</h2>
    <p id="weekly-visits">Loading...</p>

    <!-- Last Logged-In Users -->
    <h2>Last Logged-In Users</h2>
    <div id="last-users"></div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
  <script src="app.js"></script>
  <script>
    // Display Approved Games
    function displayGames() {
      db.collection('games').where('status', '==', 'approved').get()
        .then((querySnapshot) => {
          const gamesList = document.getElementById('games-list');
          gamesList.innerHTML = '';
          querySnapshot.forEach((doc) => {
            const game = doc.data();
            gamesList.innerHTML += `
              <div class="game">
                <h3>${game.name}</h3>
                <p>${game.description}</p>
                <img src="${game.thumbnail}" alt="${game.name}" width="100">
                <a href="${game.apkFile}" download>Download APK</a>
              </div>
            `;
          });
        });
    }

    // Display Weekly Site Visits
    function displayWeeklyVisits() {
      db.collection('stats').doc('visits').get()
        .then((doc) => {
          const weeklyVisits = doc.data().weeklyVisits;
          document.getElementById('weekly-visits').textContent = weeklyVisits;
        });
    }

    // Display Last Logged-In Users
    function displayLastUsers() {
      db.collection('users').orderBy('lastLogin', 'desc').limit(5).get()
        .then((querySnapshot) => {
          const lastUsers = document.getElementById('last-users');
          lastUsers.innerHTML = '';
          querySnapshot.forEach((doc) => {
            const user = doc.data();
            lastUsers.innerHTML += `
              <div class="user">
                <img src="${user.profilePicture}" alt="${user.name}" width="50">
                <p>${user.name}</p>
              </div>
            `;
          });
        });
    }

    // Check Auth State
    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = 'login.html';
      } else {
        displayGames();
        displayWeeklyVisits();
        displayLastUsers();
      }
    });
  </script>
</body>
</html>
